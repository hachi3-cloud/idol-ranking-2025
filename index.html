<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ã‚¤ãƒ‰ãƒ«å†ç”Ÿæ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚° 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; background-color: #f0f2f5; }
        .news-blue { color: #003399; }
        .news-border { border-bottom: 2px solid #003399; }
        .trending-icon { color: #ff4500; }
        a:hover { color: #cc0000; text-decoration: underline; }
        .rank-1 { color: #d4af37; font-size: 1.5rem; }
        .rank-2 { color: #c0c0c0; font-size: 1.3rem; }
        .rank-3 { color: #cd7f32; font-size: 1.1rem; }
        .tab-active { background-color: #003399; color: white; border-color: #003399; }
        [v-cloak] { display: none; }
    </style>
</head>
<body class="p-2 md:p-8">

    <div id="app" class="max-w-4xl mx-auto bg-white shadow-sm rounded-sm overflow-hidden">
        
        <header class="p-4 news-border flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold news-blue">ã‚¢ã‚¤ãƒ‰ãƒ«å†ç”Ÿæ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h1>
            <span id="last-update" class="text-xs text-gray-500 text-right">æœ€çµ‚æ›´æ–°ï¼šå–å¾—ä¸­...</span>
        </header>

        <div id="error-msg" class="hidden p-8 text-center text-gray-500 italic">
            <p class="text-2xl mb-2">ğŸš§</p>
            ç¾åœ¨ã€ãƒ‡ãƒ¼ã‚¿é›†è¨ˆã«ã‚ˆã‚‹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ã§ã™ã€‚ã—ã°ã‚‰ãçµŒã£ã¦ã‹ã‚‰å†åº¦ãŠè¶Šã—ãã ã•ã„ã€‚
        </div>

        <div id="main-content">
            <div class="px-4 pt-4">
                <input type="text" id="search-input" placeholder="ã‚°ãƒ«ãƒ¼ãƒ—åã‚„æ¥½æ›²åã§æ¤œç´¢..." 
                       class="w-full p-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
            </div>

            <section class="p-4 bg-blue-50 mt-4">
                <h2 class="text-sm font-bold mb-2 text-blue-800">ğŸ“ˆ ä»Šé€±ã®æ³¨ç›®ï¼ˆä¼¸ã³ç‡NO.1ï¼‰</h2>
                <div id="featured-card" class="bg-white p-4 border border-blue-200 rounded flex items-center justify-between">
                    <div>
                        <a id="featured-link" href="#" target="_blank">
                            <span id="featured-name" class="text-lg font-bold news-blue leading-tight">èª­ã¿è¾¼ã¿ä¸­...</span>
                        </a>
                        <p id="featured-stats" class="text-xs text-gray-600 mt-1"></p>
                    </div>
                    <div class="text-right ml-2">
                        <span class="bg-orange-500 text-white text-xs px-2 py-1 rounded font-bold animate-pulse whitespace-nowrap">Hot!</span>
                    </div>
                </div>
            </section>

            <section class="p-4">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 space-y-2 md:space-y-0">
                    <h2 class="text-lg font-bold">ğŸ“Š å†ç”Ÿæ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
                    <div class="flex space-x-1 text-xs">
                        <button onclick="changeMode('daily')" id="btn-daily" class="px-4 py-1 border rounded-l-full font-bold text-gray-600">å‰æ—¥æ¯”</button>
                        <button onclick="changeMode('weekly')" id="btn-weekly" class="px-4 py-1 border rounded-r-full font-bold tab-active">é€±é–“(7æ—¥)</button>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-100 text-xs text-gray-600">
                                <th class="p-2 border-b w-12 text-center font-normal">é †ä½</th>
                                <th class="p-2 border-b font-normal">æ¥½æ›²ã‚¿ã‚¤ãƒˆãƒ« / ã‚°ãƒ«ãƒ¼ãƒ—å</th>
                                <th id="table-head-inc" class="p-2 border-b text-right font-normal">ç›´è¿‘7æ—¥é–“ã®å†ç”Ÿå›æ•°</th>
                                <th class="p-2 border-b text-center font-normal">ç†±é‡</th>
                            </tr>
                        </thead>
                        <tbody id="ranking-body"></tbody>
                    </table>
                </div>

                <div class="flex justify-center space-x-2 mt-6 pb-4">
                    <button onclick="changePage(1)" id="pg-1" class="px-4 py-1 border rounded text-sm tab-active">1-50ä½</button>
                    <button onclick="changePage(2)" id="pg-2" class="px-4 py-1 border rounded text-sm text-gray-600">51-100ä½</button>
                </div>
            </section>
        </div>

        <footer class="p-4 text-center text-xs text-gray-400 border-t">
            &copy; 2026 ã‚¢ã‚¤ãƒ‰ãƒ«ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
        </footer>
    </div>

    <script>
        let allRanking = [];
        let filteredRanking = [];
        let currentMode = 'weekly'; // 'daily' or 'weekly'
        let currentPage = 1;
        let searchQuery = "";

        async function loadRanking() {
            try {
                const response = await fetch('data.json?v=' + new Date().getTime());
                if (!response.ok) throw new Error();
                const data = await response.json();
                
                document.getElementById('last-update').textContent = `æœ€çµ‚æ›´æ–°ï¼š${data.updated_at}`;
                allRanking = data.ranking;
                applyFilter();
            } catch (error) {
                document.getElementById('main-content').classList.add('hidden');
                document.getElementById('error-msg').classList.remove('hidden');
            }
        }

        function renderUI() {
            const rankingBody = document.getElementById('ranking-body');
            const start = (currentPage - 1) * 50;
            const end = start + 50;
            const pageItems = filteredRanking.slice(start, end);

            // æ³¨ç›®å‹•ç”»ï¼ˆå¸¸ã«å…¨ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰1ä½ã‚’è¡¨ç¤ºï¼‰
            const top = allRanking[0];
            document.getElementById('featured-name').textContent = top.title;
            document.getElementById('featured-link').href = `https://www.youtube.com/watch?v=${top.video_id}`;
            document.getElementById('featured-stats').textContent = `${top.idol_name} / ä¼¸ã³ç‡ ${((currentMode === 'weekly' ? top.rate : top.rate_daily) * 100).toFixed(1)}%`;

            // ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›´
            document.getElementById('table-head-inc').textContent = currentMode === 'weekly' ? 'ç›´è¿‘7æ—¥é–“ã®å†ç”Ÿå›æ•°' : 'å‰æ—¥ã®å†ç”Ÿå›æ•°';

            rankingBody.innerHTML = '';
            pageItems.forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-50 border-b last:border-0";
                
                const rank = start + index + 1;
                let rankDisplay = rank;
                if (rank === 1) rankDisplay = '<span class="rank-1">ğŸ¥‡</span>';
                else if (rank === 2) rankDisplay = '<span class="rank-2">ğŸ¥ˆ</span>';
                else if (rank === 3) rankDisplay = '<span class="rank-3">ğŸ¥‰</span>';
                
                const inc = currentMode === 'weekly' ? item.increase : item.inc_daily;
                const rate = currentMode === 'weekly' ? item.rate : item.rate_daily;
                const trendingIcon = item.is_trending ? '<span class="trending-icon font-bold text-[10px]">Hot</span>' : '';
                
                tr.innerHTML = `
                    <td class="p-3 text-center font-bold text-gray-400 text-lg">${rankDisplay}</td>
                    <td class="p-3">
                        <div class="font-bold news-blue text-[13px] md:text-sm leading-tight">
                            <a href="https://www.youtube.com/watch?v=${item.video_id}" target="_blank">${item.title}</a>
                        </div>
                        <div class="text-[10px] text-gray-500 mt-1">
                            <a href="https://www.youtube.com/channel/${item.channel_id}" target="_blank" class="bg-gray-100 px-1 rounded">${item.idol_name}</a>
                        </div>
                    </td>
                    <td class="p-3 text-right">
                        <div class="font-bold text-gray-700 text-sm">+${Number(inc || 0).toLocaleString()}</div>
                        <div class="text-[10px] text-green-600">${(rate * 100).toFixed(1)}%</div>
                    </td>
                    <td class="p-3 text-center text-xl">${trendingIcon}</td>
                `;
                rankingBody.appendChild(tr);
            });
        }

        function applyFilter() {
            filteredRanking = allRanking.filter(item => 
                item.title.toLowerCase().includes(searchQuery.toLowerCase()) || 
                item.idol_name.toLowerCase().includes(searchQuery.toLowerCase())
            );
            renderUI();
        }

        function changeMode(mode) {
            currentMode = mode;
            document.getElementById('btn-daily').classList.toggle('tab-active', mode === 'daily');
            document.getElementById('btn-weekly').classList.toggle('tab-active', mode === 'weekly');
            renderUI();
        }

        function changePage(page) {
            currentPage = page;
            document.getElementById('pg-1').classList.toggle('tab-active', page === 1);
            document.getElementById('pg-2').classList.toggle('tab-active', page === 2);
            renderUI();
        }

        document.getElementById('search-input').addEventListener('input', (e) => {
            searchQuery = e.target.value;
            currentPage = 1; // æ¤œç´¢æ™‚ã¯1ãƒšãƒ¼ã‚¸ç›®ã«æˆ»ã™
            applyFilter();
        });

        loadRanking();
    </script>
</body>
</html>
