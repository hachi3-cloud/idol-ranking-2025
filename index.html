<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ã‚¤ãƒ‰ãƒ«MVå†ç”Ÿæ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚° 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; background-color: #f0f2f5; }
        .news-blue { color: #003399; }
        .news-border { border-bottom: 2px solid #003399; }
        .trending-icon { color: #ff4500; }
        a:hover { color: #cc0000; text-decoration: underline; }
        .rank-1 { color: #d4af37; font-size: 1.5rem; }
        .rank-2 { color: #c0c0c0; font-size: 1.3rem; }
        .rank-3 { color: #cd7f32; font-size: 1.1rem; }
        .tab-active { background-color: #003399; color: white; border-color: #003399; }
    </style>
    
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E3GD1BRZDN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-E3GD1BRZDN');
</script>
    
</head>
<body class="p-2 md:p-8">

    <div id="app" class="max-w-4xl mx-auto bg-white shadow-sm rounded-sm overflow-hidden">
        
        <header class="p-4 news-border flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold news-blue leading-tight">ã‚¢ã‚¤ãƒ‰ãƒ«å†ç”Ÿæ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h1>
            <span id="last-update" class="text-xs text-gray-500 text-right whitespace-nowrap ml-2">æœ€çµ‚æ›´æ–°ï¼šå–å¾—ä¸­...</span>
        </header>

        <div id="error-msg" class="hidden p-20 text-center text-gray-500 italic">
            <p class="text-4xl mb-4">ğŸš§</p>
            <p class="text-lg">ç¾åœ¨ã€ãƒ‡ãƒ¼ã‚¿é›†è¨ˆã«ã‚ˆã‚‹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­ã§ã™ã€‚<br>ã—ã°ã‚‰ãçµŒã£ã¦ã‹ã‚‰å†åº¦ãŠè¶Šã—ãã ã•ã„ã€‚</p>
        </div>

        <div id="main-content">
            <div class="px-4 pt-4">
                <input type="text" id="search-input" placeholder="ã‚°ãƒ«ãƒ¼ãƒ—åã‚„æ¥½æ›²åã§æ¤œç´¢..." 
                       class="w-full p-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 shadow-sm">
            </div>

            <section class="p-4 bg-blue-50 mt-4">
                <h2 class="text-sm font-bold mb-2 text-blue-800">ğŸ“ˆ ä»Šé€±ã®æ³¨ç›®ï¼ˆä¼¸ã³ç‡NO.1ï¼‰</h2>
                <div id="featured-card" class="bg-white p-4 border border-blue-200 rounded flex items-center justify-between">
                    <div>
                        <a id="featured-link" href="#" target="_blank">
                            <span id="featured-name" class="text-lg font-bold news-blue leading-tight">èª­ã¿è¾¼ã¿ä¸­...</span>
                        </a>
                        <p id="featured-stats" class="text-xs text-gray-600 mt-1"></p>
                    </div>
                    <div class="text-right ml-2">
                        <span class="bg-orange-500 text-white text-xs px-2 py-1 rounded font-bold animate-pulse whitespace-nowrap">Hot!</span>
                    </div>
                </div>
            </section>

            <section class="p-4">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 space-y-2 md:space-y-0">
                    <h2 class="text-lg font-bold">ğŸ“Š å†ç”Ÿæ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
                    <div class="flex space-x-1 text-xs">
                        <button onclick="changeMode('daily')" id="btn-daily" class="px-4 py-1 border rounded-l-full font-bold text-gray-600 hover:bg-gray-50">å‰æ—¥æ¯”</button>
                        <button onclick="changeMode('weekly')" id="btn-weekly" class="px-4 py-1 border rounded-r-full font-bold tab-active">é€±é–“(7æ—¥)</button>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-100 text-[10px] md:text-xs text-gray-600">
                                <th class="p-2 border-b w-10 text-center font-normal">é †ä½</th>
                                <th class="p-2 border-b font-normal">æ¥½æ›²ã‚¿ã‚¤ãƒˆãƒ« / ã‚°ãƒ«ãƒ¼ãƒ—å</th>
                                <th id="table-head-inc" class="p-2 border-b text-right font-normal">ç›´è¿‘7æ—¥é–“ã®å†ç”Ÿå›æ•°</th>
                                <th class="p-2 border-b text-center font-normal">ç†±é‡</th>
                            </tr>
                        </thead>
                        <tbody id="ranking-body"></tbody>
                    </table>
                </div>

                <div class="flex justify-center space-x-2 mt-6 pb-4">
                    <button onclick="changePage(1)" id="pg-1" class="px-4 py-1 border rounded text-xs tab-active">1-50ä½</button>
                    <button onclick="changePage(2)" id="pg-2" class="px-4 py-1 border rounded text-xs text-gray-600 hover:bg-gray-50">51-100ä½</button>
                </div>
            </section>
        </div>

        <footer class="p-4 text-center text-[10px] text-gray-400 border-t bg-gray-50">
            &copy; 2026 ã‚¢ã‚¤ãƒ‰ãƒ«ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
        </footer>
    </div>

    <script>
        let rawData = null; // data.jsonã®ä¸­èº«
        let currentMode = 'weekly'; 
        let currentPage = 1;
        let searchQuery = "";

        async function loadRanking() {
            try {
                const response = await fetch('data.json?t=' + new Date().getTime());
                if (!response.ok) throw new Error();
                rawData = await response.json();
                
                document.getElementById('last-update').textContent = `æœ€çµ‚æ›´æ–°ï¼š${rawData.updated_at}`;
                renderUI();
            } catch (error) {
                document.getElementById('main-content').classList.add('hidden');
                document.getElementById('error-msg').classList.remove('hidden');
            }
        }

        function renderUI() {
            if (!rawData) return;
            const rankingBody = document.getElementById('ranking-body');
            
            // 1. ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ï¼ˆé€±é–“ or å‰æ—¥ï¼‰ã®å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            let baseList = currentMode === 'weekly' ? rawData.weekly : rawData.daily;

            // 2. æ¤œç´¢ãƒ•ã‚£ãƒ«ã‚¿ã‚’é©ç”¨
            let filtered = baseList.filter(item => 
                item.title.toLowerCase().includes(searchQuery.toLowerCase()) || 
                item.idol_name.toLowerCase().includes(searchQuery.toLowerCase())
            );

            // 3. ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ1-50ä½ / 51-100ä½ï¼‰
            const start = (currentPage - 1) * 50;
            const end = start + 50;
            const pageItems = filtered.slice(start, end);

            // æ³¨ç›®å‹•ç”»ï¼ˆå¸¸ã«å…¨ä½“ã®1ä½ã‚’è¡¨ç¤ºï¼‰
            const top = baseList[0];
            if (top) {
                document.getElementById('featured-name').textContent = top.title;
                document.getElementById('featured-link').href = `https://www.youtube.com/watch?v=${top.video_id}`;
                document.getElementById('featured-stats').textContent = `${top.idol_name} / ä¼¸ã³ç‡ ${((currentMode === 'weekly' ? top.rate : top.rate_daily) * 100).toFixed(1)}%`;
            }

            document.getElementById('table-head-inc').textContent = currentMode === 'weekly' ? 'ç›´è¿‘7æ—¥é–“ã®å†ç”Ÿå›æ•°' : 'å‰æ—¥ã®å†ç”Ÿå›æ•°';

            rankingBody.innerHTML = '';
            pageItems.forEach((item) => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-50 border-b last:border-0";
                
                // --- ã€ã“ã“ãŒä¿®æ­£ãƒã‚¤ãƒ³ãƒˆï¼ã€‘ ---
                // æ¤œç´¢çµæœã®é †ç•ªã§ã¯ãªãã€å…ƒã® baseList ã®ä¸­ã§ã®é †ç•ªï¼ˆ+1ï¼‰ã‚’æ¢ã—ã¦é †ä½ã¨ã™ã‚‹
                const originalRank = baseList.indexOf(item) + 1;
                
                let rankDisplay = originalRank;
                if (originalRank === 1) rankDisplay = '<span class="rank-1">ğŸ¥‡</span>';
                else if (originalRank === 2) rankDisplay = '<span class="rank-2">ğŸ¥ˆ</span>';
                else if (originalRank === 3) rankDisplay = '<span class="rank-3">ğŸ¥‰</span>';
                // ------------------------------
                
const views = Number(item.views || 0).toLocaleString(); 
// JSONã®é …ç›®åï¼ˆinc_1d / inc_7dï¼‰ã«åˆã‚ã›ã¦ä¿®æ­£
const inc = currentMode === 'daily' ? (item.inc_1d || 0) : (item.inc_7d || 0);
const rate = currentMode === 'daily' ? (item.rate_1d || 0) : (item.rate_7d || 0);

// æ€¥ä¸Šæ˜‡ï¼ˆis_trendingï¼‰ã®åˆ¤å®š
const trendingIcon = item.is_trending ? '<span class="trending-icon">ğŸ”¥</span>' : '';

tr.innerHTML = `
    <td class="p-3 text-center ${index < 3 ? 'rank-' + (index + 1) : 'font-bold text-gray-400'}">${index + 1}</td>
    <td class="p-3">
        <div class="font-bold text-gray-800 text-sm md:text-base line-clamp-1">${item.title}</div>
        <div class="flex items-center gap-2 mt-1">
            <div class="text-[10px] text-gray-500">
                <a href="idol.html?id=${item.idol_id}" class="bg-blue-50 px-1 rounded text-blue-600 font-bold">${item.idol_name}</a>
            </div>
            <div class="text-[10px] text-gray-400">ç´¯è¨ˆ: ${views}å›</div>
        </div>
    </td>
    <td class="p-3 text-right">
        <div class="font-bold text-gray-700 text-sm leading-none">+${Number(inc).toLocaleString()}</div>
        <div class="text-[10px] text-green-600 mt-1">${(Number(rate) * 100).toFixed(1)}%</div>
    </td>
    <td class="p-3 text-center text-xl">${trendingIcon}</td>
`;
                rankingBody.appendChild(tr);
            });
        }

        function changeMode(mode) {
            currentMode = mode;
            document.getElementById('btn-daily').classList.toggle('tab-active', mode === 'daily');
            document.getElementById('btn-weekly').classList.toggle('tab-active', mode === 'weekly');
            currentPage = 1; 
            renderUI();
        }

        function changePage(page) {
            currentPage = page;
            document.getElementById('pg-1').classList.toggle('tab-active', page === 1);
            document.getElementById('pg-2').classList.toggle('tab-active', page === 2);
            renderUI();
        }

        document.getElementById('search-input').addEventListener('input', (e) => {
            searchQuery = e.target.value;
            currentPage = 1;
            renderUI();
        });

        loadRanking();
    </script>
</body>
</html>
